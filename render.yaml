# ğŸš€ Render.com Configuration - KEREN-Z
# Backend API Service (Express + TypeScript + Supabase)

services:
  # ğŸ“¦ Backend API Service
  - type: web
    name: keren-z-api
    env: node
    runtime: node
    region: frankfurt  # Choisir la rÃ©gion la plus proche
    plan: free  # Plan gratuit pour commencer

    # ğŸ“ Repository & Branch
    # Render dÃ©tectera automatiquement le repo depuis GitHub
    # Branch par dÃ©faut: main

    # ğŸ”§ Build & Start Commands
    # Le projet utilise TypeScript et nÃ©cessite compilation
    buildCommand: npm install && npm run build
    startCommand: npm run start:render

    # ğŸŒ Environment Variables
    envVars:
      # Node Configuration
      - key: NODE_VERSION
        value: "20"
      - key: NODE_ENV
        value: production
      - key: PORT
        value: "10000"

      # ğŸ—„ï¸ Database (Supabase)
      - key: SUPABASE_URL
        sync: false  # âš ï¸ Ã€ configurer dans Dashboard Render
      - key: SUPABASE_SERVICE_KEY
        sync: false  # âš ï¸ ClÃ© privÃ©e backend uniquement
      - key: VITE_SUPABASE_URL
        sync: false
      - key: VITE_SUPABASE_ANON_KEY
        sync: false

      # ğŸ’³ Stripe Payment
      - key: STRIPE_SECRET_KEY
        sync: false  # âš ï¸ sk_live_xxx ou sk_test_xxx
      - key: STRIPE_WEBHOOK_SECRET
        sync: false  # âš ï¸ whsec_xxx
      - key: VITE_STRIPE_PUBLISHABLE_KEY
        sync: false

      # ğŸ“§ Email Service (SendGrid)
      - key: SENDGRID_API_KEY
        sync: false  # âš ï¸ API Key SendGrid

      # ğŸ¤– AI Services (Optionnel)
      - key: OPENAI_API_KEY
        sync: false
      - key: GEMINI_API_KEY
        sync: false

      # ğŸŒ Frontend URL (CORS)
      - key: FRONTEND_URL
        value: https://keren-z.netlify.app  # âš ï¸ Ajuster avec URL Netlify rÃ©elle

      # ğŸ—ï¸ Builder.io (Optionnel)
      - key: PUBLIC_BUILDER_KEY
        value: 64acbf47412843a9a0fbf6f4c8852e80

    # â¤ï¸ Health Check
    # Endpoint pour vÃ©rifier que le serveur est opÃ©rationnel
    healthCheckPath: /api/health

    # ğŸ”„ Auto-Deploy
    # DÃ©ploiement automatique Ã  chaque push sur main
    autoDeploy: true

# ğŸ“š DOCUMENTATION COMPLÃˆTE
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ¯ Ã‰TAPES DE DÃ‰PLOIEMENT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# 1ï¸âƒ£ Connecter GitHub Ã  Render:
#    - Aller sur https://dashboard.render.com
#    - Cliquer "New +" â†’ "Blueprint"
#    - Connecter repository: https://github.com/CodeNoLimits/KEREN-Z
#    - Render dÃ©tectera automatiquement ce fichier render.yaml
#    - Cliquer "Apply"
#
# 2ï¸âƒ£ Configurer les Variables d'Environnement:
#    Une fois le service crÃ©Ã©, aller dans Environment et ajouter:
#
#    ğŸ“Œ SUPABASE (OBLIGATOIRE):
#    - SUPABASE_URL=https://xxx.supabase.co
#    - SUPABASE_SERVICE_KEY=eyJxxx (service_role key)
#    - VITE_SUPABASE_URL=https://xxx.supabase.co
#    - VITE_SUPABASE_ANON_KEY=eyJxxx (anon key)
#
#    ğŸ’³ STRIPE (OBLIGATOIRE):
#    - STRIPE_SECRET_KEY=sk_live_xxx (ou sk_test_xxx pour test)
#    - STRIPE_WEBHOOK_SECRET=whsec_xxx
#    - VITE_STRIPE_PUBLISHABLE_KEY=pk_live_xxx
#
#    ğŸ“§ SENDGRID (RECOMMANDÃ‰):
#    - SENDGRID_API_KEY=SG.xxx
#
#    ğŸŒ FRONTEND URL:
#    - FRONTEND_URL=https://votre-site.netlify.app
#
# 3ï¸âƒ£ Attendre le Build:
#    Le premier dÃ©ploiement peut prendre 5-10 minutes
#    Surveiller les logs dans le dashboard Render
#
# 4ï¸âƒ£ Tester le DÃ©ploiement:
#    curl https://keren-z-api.onrender.com/api/health
#    Devrait retourner: {"status":"ok","timestamp":"..."}
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ”‘ OBTENIR LES CLÃ‰S API
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# ğŸ—„ï¸ Supabase:
#    1. CrÃ©er projet sur https://supabase.com
#    2. Settings â†’ API â†’ Project URL (SUPABASE_URL)
#    3. Settings â†’ API â†’ service_role key (SUPABASE_SERVICE_KEY)
#    4. Settings â†’ API â†’ anon public key (VITE_SUPABASE_ANON_KEY)
#
# ğŸ’³ Stripe:
#    1. Dashboard: https://dashboard.stripe.com
#    2. Developers â†’ API keys â†’ Secret key (STRIPE_SECRET_KEY)
#    3. Developers â†’ API keys â†’ Publishable key (VITE_STRIPE_PUBLISHABLE_KEY)
#    4. Webhooks:
#       - Add endpoint: https://keren-z-api.onrender.com/api/webhooks/stripe
#       - Ã‰vÃ©nements: payment_intent.succeeded, payment_intent.payment_failed
#       - Copier Webhook Secret (STRIPE_WEBHOOK_SECRET)
#
# ğŸ“§ SendGrid:
#    1. CrÃ©er compte sur https://sendgrid.com
#    2. Settings â†’ API Keys â†’ Create API Key
#    3. Full Access permissions
#    4. Copier la clÃ© (SENDGRID_API_KEY)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âš™ï¸ CONFIGURATION POST-DÃ‰PLOIEMENT
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# 1. Configurer Stripe Webhook:
#    - URL: https://keren-z-api.onrender.com/api/webhooks/stripe
#    - Ajouter STRIPE_WEBHOOK_SECRET dans Render
#
# 2. Mettre Ã  jour l'URL Frontend dans Netlify:
#    - VITE_API_URL=https://keren-z-api.onrender.com
#
# 3. Configurer CORS si nÃ©cessaire:
#    - S'assurer que FRONTEND_URL correspond Ã  votre site Netlify
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ” DÃ‰PANNAGE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# âŒ Build Failed:
#    - VÃ©rifier les logs dans Render Dashboard
#    - S'assurer que npm install && npm run build fonctionne localement
#    - Node version: 20 (dÃ©finie dans envVars)
#
# âŒ Service Won't Start:
#    - VÃ©rifier que toutes les variables d'environnement sont dÃ©finies
#    - VÃ©rifier les logs de dÃ©marrage
#    - Health check doit rÃ©pondre sur /api/health
#
# âŒ Database Connection Failed:
#    - VÃ©rifier SUPABASE_URL et SUPABASE_SERVICE_KEY
#    - Tester la connexion depuis un autre outil
#
# âŒ CORS Errors:
#    - VÃ©rifier que FRONTEND_URL correspond exactement Ã  l'URL Netlify
#    - Pas de trailing slash
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“Š MONITORING & MAINTENANCE
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# - Logs: Dashboard Render â†’ Service â†’ Logs
# - Metrics: CPU, RAM, Response time
# - Health: Render vÃ©rifie /api/health toutes les 30 secondes
# - Downtime: Plan gratuit peut avoir cold starts (dÃ©lai de 30s)
#
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ PRÃŠT POUR PRODUCTION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#
# âœ… Service dÃ©ployÃ©
# âœ… Variables d'environnement configurÃ©es
# âœ… Stripe webhook configurÃ©
# âœ… Health check opÃ©rationnel
# âœ… Frontend connectÃ©
#
# Le backend est LIVE ! ğŸ‰
